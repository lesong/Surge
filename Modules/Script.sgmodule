#!name=lesong自用脚本 
#!desc=最后更新时间 2022-05-09 08:06:06
[General]
doh-server = %APPEND% https://doh.pub/dns-query

[Panel]
timecard = script-name=timecard,update-interval=3600
# > 流媒体解锁检测
stream-all = script-name=stream-all, title="流媒体解锁检测", content="请刷新面板", update-interval=-1
# > 刷新DNS缓存
flushDNS = script-name=flushDNS,title="Flush DNS",content="请刷新",update-interval=600

[Script]
# > 流媒体解锁检测
timecard = type=generic,timeout=10,script-path=https://raw.githubusercontent.com/smartmimi/conf/master/surge/timecard.js
stream-all = type=generic, timeout=15, script-path= https://raw.githubusercontent.com/leohaol/Surge/main/Script/Stream-all.js

# > 刷新DNS缓存
flushDNS = type=generic,timeout=5,script-path=https://raw.githubusercontent.com/zZPiglet/Task/master/asset/flushDNS.js,argument=title=DNS FLush&icon=arrow.clockwise&color=#3d3d5b

# > 百度搜索防跳转 App Store(boxer.baidu.com)
baidu-no-redirect.js = type=http-response,pattern=^https?:\/\/boxer\.baidu\.com\/scheme\?scheme,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/baidu-no-redirect.js

# > 苹果天气相关(weather-data.apple.com, weather-map.apple.com)
Apple Weather Availability = type=http-response, pattern=^https?:\/\/weather-data\.apple\.com\/(v1|v2)\/availability\/.*, requires-body=1, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Weather.Availability.js, argument=
Apple Weather = type=http-response, pattern=^https?:\/\/weather-data\.apple\.com\/(v1|v2)\/weather\/.*, requires-body=1, timeout=20, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Weather.js, argument=
Apple Weather Map = type=http-request, pattern=^https?:\/\/weather-map\.apple\.com\/(v1|v2)\/mapOverlay\/.*(\?.*country=CN.*), requires-body=0, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Weather.Map.js, argument=
# > Response Geo Services to US检测地区(gspe1-ssl.ls.apple.com)
Geo Services = type=http-request, pattern=^https?:\/\/gspe\d*-ssl\.ls\.apple\.com(\/pep\/gcc), argument=GeoCountryCode=US, requires-body=0, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Geo_Services.js
# > Redirect Apple Maps to CN检测地区(gspe35-ssl.ls.apple.com)
(^https?:\/\/gspe\d*-ssl\.ls\.apple\.)(com|cn)(\/.*)(country_code=[A-Z]{2})(.*) $1$2$3country_code=CN$5 header
(^https?:\/\/gspe\d*-ssl\.ls\.apple\.)(com|cn)(\/.*)(environment=[a-z/-]{4,})(.*) $1$2$3environment=prod-cn$5 header
# > 全面自定义「Siri与搜索」的功能(api*.smoot.apple.com, api*.smoot.apple.cn)
# Bag (iOS/macOS)
Siri Suggestions Service = type=http-request, pattern=^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/bag\?(.*), requires-body=0, timeout=5, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri.request.js, argument=
Siri Suggestions Service = type=http-response, pattern=^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/bag\?(.*), requires-body=1, timeout=10, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri.response.js, argument=
# Spotlight & Look Up Search (iOS/macOS)
Spotlight & Look Up Search = type=http-request, pattern=^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/search\?(.*), requires-body=0, timeout=5, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri.request.js, argument=
Spotlight & Look Up Search = type=http-response, pattern=^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/search\?(.*), requires-body=1, timeout=10, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri.response.js, argument=
# Siri Infomation Card (macOS)
Siri Infomation Card = type=http-request, pattern=^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/card\?(.*), requires-body=0, timeout=5, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri.request.js, argument=
Siri Infomation Card = type=http-response, pattern=^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/card\?(.*), requires-body=1, timeout=10, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri.response.js, argument=
# > 解锁TV app全功能(uts-api.itunes.apple.com)
# Enable All TV app Tabs
Apple TV = type=http-response, pattern=^https?:\/\/uts-api\.itunes\.apple\.com\/uts\/(v1|v2|v3)\/configurations\?.*, requires-body=1, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# TV app Tabs, Redirect Desktop Platform to AppleTV, Redirect Sports and Kids Tabs StoreFront to US (143441)
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com\/uts\/(v1|v2|v3)\/canvases\/Roots\/(watchNow|tahoma_watchnow|movies|tv|sports|kids)\?.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# TV app movies and shows and sports infomation Webs, Redirect Desktop Platform to AppleTV
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com\/uts\/(v1|v2|v3)\/(movies|shows|sports|sporting-events).*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# TV UpNext, Redirect Desktop Platform to AppleTV
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/shelves\/uts.col.UpNext.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# TV channels, Redirect StoreFront to US (143441)
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/brands\?.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# TV Live Playables, Redirect StoreFront to US (143441)
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/playables.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# TV Favorites Teams web, Redirect StoreFront to US (143441)
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/favorites\?.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# TV Watchlist Function, Redirect desktop Platform to iPad
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/watchlist.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# Enable TV Favorites Teams Function, Redirect StoreFront to US (143441)
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com\/uts\/(v1|v2|v3)\/favorites\/(add|remove).*, requires-body=1, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# TV Product View, no Redirect
# Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/view\/product\/.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# > 解锁🇺🇸US地区的News，注：需配合域名集使用，使用过程中gateway.icloud.com需走代理线路
#host= news-client.apple.com, news-client-search.apple.com, news-edge.apple.com, news-events.apple.com
Apple News = type=http-request, pattern=^https?:\/\/news-(edge|events)\.apple\.com\/(v1\/configs|analyticseventsv2\/async).*, requires-body=1, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_News.js
Apple News = type=http-request, pattern=^https?:\/\/news-(client-search)\.apple\.com\/(v1\/search\?).*, requires-body=0, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_News.js

# > JD App 显示历史价格 by yichahucha&Small
jd_price.js = type=http-response,requires-body=1,pattern=^https?:\/\/api\.m\.jd\.com\/client\.action\?functionId=(wareBusiness|serverConfig|basicConfig),script-path=https://raw.githubusercontent.com/githubdulong/Script/master/jd_tb_price.js

# > Taobao App 显示历史价格 by yichahucha 修改Surge语法 by Small
tb_price.js = type=http-request,requires-body=1,pattern=^http:\/\/.+\/amdc\/mobileDispatch,script-path=https://raw.githubusercontent.com/githubdulong/Script/master/jd_tb_price.js
tb_price.js = type=http-response,requires-body=1,pattern=^https?:\/\/trade-acs\.m\.taobao\.com\/gw\/mtop\.taobao\.detail\.getdetail,script-path=https://raw.githubusercontent.com/githubdulong/Script/master/jd_tb_price.js

[Header Rewrite]
# > 知乎（部分替换为手机百度 Quark 的 User-Agent）
http-request ^https?:\/\/www\.zhihu\.com header-replace-regex User-Agent .+iPhone.+ "Mozilla/5.0 (iPhone; CPU iPhone OS 13_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Mobile/15E148 Safari/16C50 Quark/604.1 T7/10.3 SearchCraft/2.6.3 (Baidu; P1 8.0.0)"

# > 百度（全站替换为手机百度 Quark 的 User-Agent）
http-request ^https?:\/\/(?!d\.pcs).*(?<!map)\.baidu\.com header-replace-regex User-Agent .+iPhone.+ "Mozilla/5.0 (iPhone; CPU iPhone OS 13_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Mobile/15E148 Safari/16C50 Quark/604.1 T7/10.3 SearchCraft/2.6.3 (Baidu; P1 8.0.0)"

# > 苹果天气相关
http-request ^https?:\/\/weather-data\.apple\.com\/(v1|v2)\/weather\/.* header-del If-None-Match

[URL Rewrite]
# >> IGN China to IGN Global(gn.xn--fiqs8s)
^https?://(www.)?ign\.xn--fiqs8s/ https://cn.ign.com/ccpref/us 302
# > Bilibili SEA 解除 SIM 卡地区限制(app.biliintl.com)
(^https?:\/\/app\.biliintl\.com\/intl\/.+)(&sim_code=\d+)(.+) $1$3 302

[MITM]
hostname = %APPEND% boxer.baidu.com, www.zhihu.com, weather-data.apple.com, weather-map.apple.com, gspe1-ssl.ls.apple.com, api*.smoot.apple.com, api*.smoot.apple.cn, gspe35-ssl.ls.apple.com, uts-api.itunes.apple.com, news-client.apple.com, news-client-search.apple.com, news-edge.apple.com, news-events.apple.com, gn.xn--fiqs8s, api.m.jd.com, trade-acs.m.taobao.com, app.biliintl.com




# > 模块订阅(单独添加)
//爬虫复写去广告 https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rewrite/Surge/Advertising/Advertising.sgmodule
//什么值得买去广告 https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/script/smzdm/smzdm_remove_ads.sgmodule
//贴吧去除广告https://raw.githubusercontent.com/app2smile/rules/master/module/tieba.sgmodule
//spotify解锁https://raw.githubusercontent.com/app2smile/rules/master/module/spotify.module
//哔哩哔哩去广告https://raw.githubusercontent.com/app2smile/rules/master/module/bilibili.sgmodule
//Siri区域解锁https://raw.githubusercontent.com/VirgilClyne/iRingo/main/sgmodule/Siri_Suggestions.sgmodule
//京东辅助登陆https://raw.githubusercontent.com/Fokit/Quantumult-X/main/rewrite/jd_login_help2.sgmodule
//京东助手(注入式需key）https://raw.githubusercontent.com/githubdulong/Script/master/jdHelper.sgmodule
//京东联盟转链（联盟、助手二选一）https://raw.githubusercontent.com/githubdulong/Script/master/Surge/jdapp_to_union.sgmodule
//浏览器搜索https://raw.githubusercontent.com/githubdulong/Script/master/Surge/Q-Search_All_in_one.sgmodule
//知乎去广告https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/script/zhihu/zhihu_plus.sgmodule
//京东半自动销卡https://raw.githubusercontent.com/githubdulong/Script/master/Jd_unbindCard.sgmodule
//京东淘宝比价https://raw.githubusercontent.com/githubdulong/Script/master/jd_price2.sgmodule
//京豆https://cdn.jsdelivr.net/gh/tttwwy/surge/jd_price.sgmodule