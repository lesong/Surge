#!name=lesongè‡ªç”¨è„šæœ¬ 
#!desc=æœ€åæ›´æ–°æ—¶é—´ 2022-05-09 16:10:06

[Panel]
timecard = script-name=timecard,update-interval=3600
# > æµåª’ä½“è§£é”æ£€æµ‹
stream-all = script-name=stream-all, title="æµåª’ä½“è§£é”æ£€æµ‹", content="è¯·åˆ·æ–°é¢æ¿", update-interval=-1
# > åˆ·æ–°DNSç¼“å­˜
flushDNS = script-name=flushDNS,title="Flush DNS",content="è¯·åˆ·æ–°",update-interval=600

[Script]
# > Boxjsï¼ˆç¨³å®šç‰ˆ+æµ‹è¯•ç‰ˆï¼‰(boxjs.net, boxjs.com)
ä¼šè¯æ•°æ® = type=http-request,pattern=^https?:\/\/boxjs\.com,script-path=https://raw.githubusercontent.com/chavyleung/scripts/master/chavy.box.js, requires-body=true, timeout=120
ä¼šè¯æ•°æ® = type=http-request,pattern=^https?:\/\/boxjs\.net,script-path=https://raw.githubusercontent.com/chavyleung/scripts/master/box/chavy.boxjs.js, requires-body=true, timeout=120
# > https://sub-store ( sub.store)
Sub-Store = type=http-request,pattern=^https?:\/\/sub\.store,script-path=https://raw.githubusercontent.com/Peng-YM/Sub-Store/master/backend/sub-store.min.js,requires-body=true,timeout=120,max-size=131072

# > æµåª’ä½“è§£é”æ£€æµ‹
timecard = type=generic,timeout=10,script-path=https://raw.githubusercontent.com/smartmimi/conf/master/surge/timecard.js
stream-all = type=generic, timeout=15, script-path= https://raw.githubusercontent.com/leohaol/Surge/main/Script/Stream-all.js

# > åˆ·æ–°DNSç¼“å­˜
flushDNS = type=generic,timeout=5,script-path=https://raw.githubusercontent.com/zZPiglet/Task/master/asset/flushDNS.js,argument=title=DNS FLush&icon=arrow.clockwise&color=#3d3d5b

# > ç™¾åº¦æœç´¢é˜²è·³è½¬ App Store(boxer.baidu.com)
baidu-no-redirect.js = type=http-response,pattern=^https?:\/\/boxer\.baidu\.com\/scheme\?scheme,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/baidu-no-redirect.js
# > #è´´å§å»å¹¿å‘Šï¼ˆafd.baidu.comï¼‰
è´´å§json = type=http-response,pattern=^(http:\/\/c\.tieba\.baidu\.com\/(tiebaads\/commonbatch|c\/s\/sync)|https:\/\/afd\.baidu\.com\/afd\/entry),requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/tieba-json.js,script-update-interval=0
è´´å§proto = type=http-response,pattern=^http:\/\/c\.tieba\.baidu\.com\/c\/f\/(frs\/(page|threadlist|generalTabList)|pb\/page|excellent\/personalized),requires-body=1,binary-body-mode=1,max-size=0,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/tieba-proto.js,script-update-interval=0

# > è‹¹æœå¤©æ°”ç›¸å…³(weather-data.apple.com, weather-map.apple.com)
Apple Weather Availability = type=http-response, pattern=^https?:\/\/weather-data\.apple\.com\/(v1|v2)\/availability\/.*, requires-body=1, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Weather.Availability.js, argument=
Apple Weather = type=http-response, pattern=^https?:\/\/weather-data\.apple\.com\/(v1|v2)\/weather\/.*, requires-body=1, timeout=20, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Weather.js, argument=
Apple Weather Map = type=http-request, pattern=^https?:\/\/weather-map\.apple\.com\/(v1|v2)\/mapOverlay\/.*(\?.*country=CN.*), requires-body=0, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Weather.Map.js, argument=

# > ä¿®æ”¹å®šä½æœåŠ¡ï¼ˆconfiguration.ls.apple.com, gspe1-ssl.ls.apple.com, dispatcher.is.autonavi.comï¼‰
# Response Location Services Geo Country Code Check Result to US
Location_Services.beta = type=http-request, pattern=^https?:\/\/gspe\d*-ssl\.ls\.apple\.com(\/pep\/gcc), requires-body=0, binary-body-mode=0, max-size=0, script-update-interval=0, argument=GeoCountryCode=US, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/beta/js/Location_Services.beta.js
# Rewrite Location Services Configuration Functions Internationalization
Location_Services.beta = type=http-request, pattern=^https?:\/\/configuration\.ls\.apple\.com(\/config\/defaults\?).*, requires-body=0, binary-body-mode=0, max-size=0 ,script-update-interval=0, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/beta/js/Location_Services.beta.js
Location_Services.beta = type=http-response, pattern=^https?:\/\/configuration\.ls\.apple\.com(\/config\/defaults\?).*, requires-body=1, binary-body-mode=0, max-size=0 ,script-update-interval=0, argument=EnableAlberta=false&GEOAddressCorrectionEnabled=true&LocalitiesAndLandmarksSupported=true&PedestrianAREnabled=true&ShouldEnableLagunaBeach=true, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/beta/js/Location_Services.beta.js
# Rewrite AutoNavi Dispatcher from com.apple.compass
Location_Services.beta = type=http-request, pattern=^https?:\/\/dispatcher\.is\.autonavi\.com(\/dispatcher), requires-body=1, binary-body-mode=1, max-size=0 ,script-update-interval=0, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/beta/js/Location_Services.beta.js
# > Response Geo Services to USæ£€æµ‹åœ°åŒº(gspe1-ssl.ls.apple.com)
Geo Services = type=http-request, pattern=^https?:\/\/gspe\d*-ssl\.ls\.apple\.com(\/pep\/gcc), argument=GeoCountryCode=US, requires-body=0, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Geo_Services.js
# > Redirect Apple Maps to CNæ£€æµ‹åœ°åŒº(gspe35-ssl.ls.apple.com)
(^https?:\/\/gspe\d*-ssl\.ls\.apple\.)(com|cn)(\/.*)(country_code=[A-Z]{2})(.*) $1$2$3country_code=CN$5 header
(^https?:\/\/gspe\d*-ssl\.ls\.apple\.)(com|cn)(\/.*)(environment=[a-z/-]{4,})(.*) $1$2$3environment=prod-cn$5 header
# > å…¨é¢è‡ªå®šä¹‰ã€ŒSiriä¸æœç´¢ã€çš„åŠŸèƒ½(api*.smoot.apple.com, api*.smoot.apple.cn)
# Bag (iOS/macOS)
Siri Suggestions Service = type=http-request, pattern=^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/bag\?(.*), requires-body=0, timeout=5, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri.request.js, argument=
Siri Suggestions Service = type=http-response, pattern=^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/bag\?(.*), requires-body=1, timeout=10, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri.response.js, argument=
# Spotlight & Look Up Search (iOS/macOS)
Spotlight & Look Up Search = type=http-request, pattern=^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/search\?(.*), requires-body=0, timeout=5, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri.request.js, argument=
Spotlight & Look Up Search = type=http-response, pattern=^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/search\?(.*), requires-body=1, timeout=10, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri.response.js, argument=
# Siri Infomation Card (macOS)
Siri Infomation Card = type=http-request, pattern=^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/card\?(.*), requires-body=0, timeout=5, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri.request.js, argument=
Siri Infomation Card = type=http-response, pattern=^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/card\?(.*), requires-body=1, timeout=10, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri.response.js, argument=
# > è§£é”ï£¿TV appå…¨åŠŸèƒ½(uts-api.itunes.apple.com)
# Enable All ï£¿TV app Tabs
Apple TV = type=http-response, pattern=^https?:\/\/uts-api\.itunes\.apple\.com\/uts\/(v1|v2|v3)\/configurations\?.*, requires-body=1, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# ï£¿TV app Tabs, Redirect Desktop Platform to AppleTV, Redirect Sports and Kids Tabs StoreFront to US (143441)
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com\/uts\/(v1|v2|v3)\/canvases\/Roots\/(watchNow|tahoma_watchnow|movies|tv|sports|kids)\?.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# ï£¿TV app movies and shows and sports infomation Webs, Redirect Desktop Platform to AppleTV
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com\/uts\/(v1|v2|v3)\/(movies|shows|sports|sporting-events).*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# ï£¿TV UpNext, Redirect Desktop Platform to AppleTV
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/shelves\/uts.col.UpNext.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# ï£¿TV channels, Redirect StoreFront to US (143441)
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/brands\?.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# ï£¿TV Live Playables, Redirect StoreFront to US (143441)
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/playables.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# ï£¿TV Favorites Teams web, Redirect StoreFront to US (143441)
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/favorites\?.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# ï£¿TV Watchlist Function, Redirect desktop Platform to iPad
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/watchlist.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# Enable ï£¿TV Favorites Teams Function, Redirect StoreFront to US (143441)
Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com\/uts\/(v1|v2|v3)\/favorites\/(add|remove).*, requires-body=1, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# ï£¿TV Product View, no Redirect
# Apple TV = type=http-request, pattern=^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/view\/product\/.*, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js
# > è§£é”ğŸ‡ºğŸ‡¸USåœ°åŒºçš„ï£¿Newsï¼Œæ³¨ï¼šéœ€é…åˆåŸŸåé›†ä½¿ç”¨ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­gateway.icloud.coméœ€èµ°ä»£ç†çº¿è·¯
#host= news-client.apple.com, news-client-search.apple.com, news-edge.apple.com, news-events.apple.com
Apple News = type=http-request, pattern=^https?:\/\/news-(edge|events)\.apple\.com\/(v1\/configs|analyticseventsv2\/async).*, requires-body=1, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_News.js
Apple News = type=http-request, pattern=^https?:\/\/news-(client-search)\.apple\.com\/(v1\/search\?).*, requires-body=0, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_News.js

# > JD App æ˜¾ç¤ºå†å²ä»·æ ¼ by yichahucha&Small
jd_price.js = type=http-response,requires-body=1,pattern=^https?:\/\/api\.m\.jd\.com\/client\.action\?functionId=(wareBusiness|serverConfig|basicConfig),script-path=https://raw.githubusercontent.com/githubdulong/Script/master/jd_tb_price.js

# > Taobao App æ˜¾ç¤ºå†å²ä»·æ ¼ by yichahucha ä¿®æ”¹Surgeè¯­æ³• by Small
tb_price.js = type=http-request,requires-body=1,pattern=^http:\/\/.+\/amdc\/mobileDispatch,script-path=https://raw.githubusercontent.com/githubdulong/Script/master/jd_tb_price.js
tb_price.js = type=http-response,requires-body=1,pattern=^https?:\/\/trade-acs\.m\.taobao\.com\/gw\/mtop\.taobao\.detail\.getdetail,script-path=https://raw.githubusercontent.com/githubdulong/Script/master/jd_tb_price.js

[Header Rewrite]
# > çŸ¥ä¹ï¼ˆéƒ¨åˆ†æ›¿æ¢ä¸ºæ‰‹æœºç™¾åº¦ Quark çš„ User-Agentï¼‰
http-request ^https?:\/\/www\.zhihu\.com header-replace-regex User-Agent .+iPhone.+ "Mozilla/5.0 (iPhone; CPU iPhone OS 13_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Mobile/15E148 Safari/16C50 Quark/604.1 T7/10.3 SearchCraft/2.6.3 (Baidu; P1 8.0.0)"

# > ç™¾åº¦ï¼ˆå…¨ç«™æ›¿æ¢ä¸ºæ‰‹æœºç™¾åº¦ Quark çš„ User-Agentï¼‰
http-request ^https?:\/\/(?!d\.pcs).*(?<!map)\.baidu\.com header-replace-regex User-Agent .+iPhone.+ "Mozilla/5.0 (iPhone; CPU iPhone OS 13_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Mobile/15E148 Safari/16C50 Quark/604.1 T7/10.3 SearchCraft/2.6.3 (Baidu; P1 8.0.0)"

# > è‹¹æœå¤©æ°”ç›¸å…³
http-request ^https?:\/\/weather-data\.apple\.com\/(v1|v2)\/weather\/.* header-del If-None-Match

# > å¾®ä¿¡(mp.weixin.qq.com)
å¾®ä¿¡å»å¹¿å‘Š = type=http-request,pattern=^https://mp\.weixin\.qq\.com/mp/getappmsgad,script-path=https://raw.githubusercontent.com/scomper/Surge/master/Scripts/WeChat.js,script-update-interval=0

# > Youtube æ— ä¸­æ–‡å­—å¹•æœºç¿»(www.youtube.com)
Youtube æ— ä¸­æ–‡å­—å¹•æœºç¿» = type=http-request,pattern=https:\/\/www.youtube.com\/api\/timedtext\?.+&lang=(?!(zh|zh\-Hans)&)((?!&tlang=zh\-Hans).)*$,requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/mieqq/mieqq/master/replace-body.js,argument=\sHTTP/1\.1(\r\n)=&tlang=zh-Hans HTTP/1.1$1,script-update-interval=0

# > å½©äº‘å¤©æ°”é¢„æŠ¥ï¼ˆweather-data.apple.com, api.weather.comï¼‰
è·å–ç»çº¬åº¦ = type=http-request, pattern=https:\/\/((weather-data\.apple)|(api.weather))\.com, script-path=https://raw.githubusercontent.com/Peng-YM/QuanX/master/Tasks/caiyun.js, require-body=false
å½©äº‘å¤©æ°” = type=cron,cronexp=0 6-22/2 * * *,wake-system=1,timeout=30,script-path=https://raw.githubusercontent.com/Peng-YM/QuanX/master/Tasks/caiyun.js

[URL Rewrite]
# >> IGN China to IGN Global(gn.xn--fiqs8s)
^https?://(www.)?ign\.xn--fiqs8s/ https://cn.ign.com/ccpref/us 302
# > Bilibili SEA è§£é™¤ SIM å¡åœ°åŒºé™åˆ¶(app.biliintl.com)
(^https?:\/\/app\.biliintl\.com\/intl\/.+)(&sim_code=\d+)(.+) $1$3 302
# Redirect Google Search Service
^https?:\/\/(www.)?(g|google)\.cn https://www.google.com 302

[MITM]
hostname = %APPEND% boxer.baidu.com, www.zhihu.com, weather-data.apple.com, weather-map.apple.com, gspe1-ssl.ls.apple.com, api*.smoot.apple.com, api*.smoot.apple.cn, gspe35-ssl.ls.apple.com, uts-api.itunes.apple.com, news-client.apple.com, news-client-search.apple.com, news-edge.apple.com, news-events.apple.com, gn.xn--fiqs8s, api.m.jd.com, trade-acs.m.taobao.com, app.biliintl.com, afd.baidu.com, boxjs.net, boxjs.com, sub.store, mp.weixin.qq.com, www.youtube.com, api.weather.com, configuration.ls.apple.com, gspe1-ssl.ls.apple.com, dispatcher.is.autonavi.com




# > æ¨¡å—è®¢é˜…(å•ç‹¬æ·»åŠ )
//äº¬ä¸œè¾…åŠ©ç™»é™†https://raw.githubusercontent.com/Fokit/Quantumult-X/main/rewrite/jd_login_help2.sgmodule
//äº¬ä¸œåŠ©æ‰‹(æ³¨å…¥å¼éœ€keyï¼‰https://raw.githubusercontent.com/githubdulong/Script/master/jdHelper.sgmodule
//äº¬ä¸œè”ç›Ÿè½¬é“¾ï¼ˆè”ç›Ÿã€åŠ©æ‰‹äºŒé€‰ä¸€ï¼‰https://raw.githubusercontent.com/githubdulong/Script/master/Surge/jdapp_to_union.sgmodule
//æµè§ˆå™¨æœç´¢https://raw.githubusercontent.com/githubdulong/Script/master/Surge/Q-Search_All_in_one.sgmodule
//çŸ¥ä¹å»å¹¿å‘Šhttps://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/script/zhihu/zhihu_plus.sgmodule
//äº¬ä¸œåŠè‡ªåŠ¨é”€å¡https://raw.githubusercontent.com/githubdulong/Script/master/Jd_unbindCard.sgmodule
//äº¬è±†https://cdn.jsdelivr.net/gh/tttwwy/surge/jd_price.sgmodule

//TikTokè§£é”æ—¥åŒº https://cdn.jsdelivr.net/gh/Semporia/TikTok-Unlock/Surge/TiKok-JP.sgmodule
//TikTokè§£é”å°å»åŒºhttps://cdn.jsdelivr.net/gh/Semporia/TikTok-Unlock/Surge/TiKok-TW.sgmodule
//TikTokè§£é”ç¾åŒºhttps://cdn.jsdelivr.net/gh/Semporia/TikTok-Unlock/Surge/TiKok-US.sgmodule
//TikTokè§£é”éŸ©åŒºhttps://cdn.jsdelivr.net/gh/Semporia/TikTok-Unlock/Surge/TiKok-kR.sgmodule